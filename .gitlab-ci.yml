before_script:
  - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $CI_REGISTRY

test_coverage:
  script:
    - docker-compose -f docker-compose.build.yml build teleferic
    - docker-compose -f docker-compose.build.yml run --rm teleferic bash coverage.sh
  stage: test
  tags:
    - shell
  artifacts:
    paths:
      - Teleferic/coverage/htmlcov

build_teleferic:
  script:
    - docker-compose -f docker-compose.build.yml run teleferic python manage.py collectstatic --no-input -c
  stage: build
  tags:
    - shell
    
stages:
  - test
  - build
  - push
  - deploy